#include "DHTesp.h"
#include <ThingSpeak.h>
#include <WiFi.h>
DHTesp dhtsensor;
TempAndHumidity data;
const int pin = 15;
long dur;
unsigned long myChannelNumber =2079754;
const char*myWriteAPIKey = "A51GV3A8YQDLEA7T";
int statusCode;
char ssid[] = "Wokwi-GUEST";
char pass[] = "";
WiFiClient client;
void setup()
{
 Serial.begin(115200);
 dhtsensor.setup(pin, DHTesp::DHT22);
 ThingSpeak.begin(client);
 WiFi.mode(WIFI_STA);
}
void loop()
{
 if(WiFi.status() !=WL_CONNECTED)
 {
  Serial.print("Attempting to connect");
  while(WiFi.status() !=WL_CONNECTED)
  {
   WiFi.begin(ssid,pass);
   for(int i=0;i<5;i++)
   {
    Serial.print(".");
    delay(1000);
   }
  }
  Serial.println("\nConnected.");
 }
 
 data = dhtsensor.getTempAndHumidity();
 Serial.println("Humi : " +String(data.humidity));
 Serial.println("Temp : " +String(data.temperature));
 Serial.println("_______________");

 ThingSpeak.setField(2,data.temperature);
 ThingSpeak.setField(3,data.humidity);
 statusCode = ThingSpeak.writeFields(myChannelNumber,myWriteAPIKey);
 if(statusCode ==200)
 Serial.println("Channel update successful.");
 else
 Serial.println("Problem Writing data. HTTP error code :"
+String(statusCode));
 delay(10000);
}
